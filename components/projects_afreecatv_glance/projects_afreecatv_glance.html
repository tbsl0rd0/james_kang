<div>
  <div class="row">
    <div class="column_12">
      <div class="header_1" ng-show="lang_menu.lang == 'korean'">
        프로젝트 - afreecatv_glance
      </div>
      <div class="header_1" ng-show="lang_menu.lang == 'english'">
        Projects - afreecatv_glance
      </div>
    </div>
  </div>
  <div class="row" style="height: 10px;"></div>
  <div class="row">
    <div class="column_12">
      <button class="button" style="float: left; margin-top: 5px;" ng-init="location = 0" ng-click="location = 0" ng-class="{ 'red': location == 0 }" ng-show="lang_menu.lang == 'korean'">
        발단
      </button>
      <button class="button" style="float: left; margin-top: 5px;" ng-click="location = 0" ng-class="{ 'red': location == 0 }" ng-show="lang_menu.lang == 'english'">
        Prolog
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 1" ng-class="{ 'red': location == 1 }" ng-show="lang_menu.lang == 'korean'">
        프로젝트 구조
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 1" ng-class="{ 'red': location == 1 }" ng-show="lang_menu.lang == 'english'">
        Project structure
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 2" ng-class="{ 'red': location == 2 }" ng-show="lang_menu.lang == 'korean'">
        댓글 수집
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 2" ng-class="{ 'red': location == 2 }" ng-show="lang_menu.lang == 'english'">
        Collecting comments
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 3" ng-class="{ 'red': location == 3 }" ng-show="lang_menu.lang == 'korean'">
        자연 언어 처리
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 3" ng-class="{ 'red': location == 3 }" ng-show="lang_menu.lang == 'english'">
        NLP
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 4" ng-class="{ 'red': location == 4 }" ng-show="lang_menu.lang == 'korean'">
        보완점
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 4" ng-class="{ 'red': location == 4 }" ng-show="lang_menu.lang == 'english'">
        Improvements
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 5" ng-class="{ 'red': location == 5 }" ng-show="lang_menu.lang == 'korean'">
        트러블 이슈
      </button>
      <button class="button" style="float: left; margin-top: 5px; margin-left: 5px;" ng-click="location = 5" ng-class="{ 'red': location == 5 }" ng-show="lang_menu.lang == 'english'">
        Trouble issues
      </button>
    </div>
  </div>
  <div class="row" style="height: 30px;"></div>
  <div class="row">
    <div class="column_12" ng-show="location == 0">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            발단
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            Prolog
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            아프리카티비에는 수많은 생방송과 동영상이 있습니다.&nbsp;
            이러한 생방송에서 발생되는 채팅과 동영상에 달리는 댓글은 말할 필요도 없이 많습니다.&nbsp;
            이러한 채팅과 댓글을 모두 보고 이슈나 트렌드를 파악하는 것은 거의 불가능에 가깝습니다.<br>
            <br>
            이 프로젝트는 채팅과 댓글로부터 자연 언어 처리를 통해 키워드를 추출하여 현재 이슈나 트렌드를 파악하고자 시작한 프로젝트입니다.&nbsp;
            그러면 현재의 이슈나 트렌드를 빠르게 파악하고 대처할 수 있을 지도 모릅니다.&nbsp;
            예를 들어 버퍼링, 렉 등의 키워드는 현재의 이슈를 빠르게 파악할 수 있도록 해주고 케빈업, 최군업 등은 현재의 트렌드를 파악할 수 있도록 해줄 것입니다.<br>
            <br>
            그러나 제약사항은 분명히 존재합니다.&nbsp;
            제가 아프리카티비 사원이 아니기 때문에 모든 채팅과 댓글을 대상으로 할 수 없습니다.&nbsp;
            따라서 이 프로젝트에서는 아프리카티비 홈페이지 메인에 있는 핫이슈 동영상의 댓글만을 대상으로 합니다.<br>
            <br>
            glance는 한눈에 이슈와 트렌드를 파악한다고 해서 지어진 이름입니다.<br>
            <br>
            <a style="color: #3498DB;" target="_blank" href="https://github.com/tbsl0rd0/glance.git"><i class="fa fa-external-link"></i> glance 깃허브</a>
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            There are many live broadcasts and videos on AfricaTV.&nbsp;
            Needless to say, live chats and comments on these videos.&nbsp;
            It's almost impossible to see all of these chats and comments and recognize the issues or trends.<br>
            <br>
            This project is for extracting keywords from chat and comments through NLP and recognizing current issues and trends.&nbsp;
            Then AfreecaTV may be able to quickly identify and respond to current issues or trends.&nbsp;
            For example, keywords such as 'buffering', 'lek', etc. will allow you to quickly identify current issues, and '케빈업' or '최군업' will give you insight into current trends.<br>
            <br>
            However, there are obvious limitations.&nbsp;
            I can not target all chats and comments because I am not an AfricanTV employee.&nbsp;
            Therefore, this project is only for the comments of the hot issue videos on the AfricaTV main page.<br>
            <br>
            glance is a name that was created by understanding issues and trends at a glance.<br>
            <br>
            <a style="color: #3498DB;" target="_blank" href="https://github.com/tbsl0rd0/glance.git"><i class="fa fa-external-link"></i> glance github</a>
          </div>
        </div>
      </div>
    </div>
    <div class="column_12" ng-show="location == 1">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            프로젝트 구조
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            Project structure
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" style="margin-top: 10px;" ng-show="lang_menu.lang == 'korean'">
            프로젝트는 AWS를 이용하여 구축합니다.&nbsp;
            다음은 프로젝트의 구조를 나타내는 다이어그램입니다.
          </div>
          <div class="paragraph" style="margin-top: 10px;" ng-show="lang_menu.lang == 'english'">
            Projects are built using AWS.&nbsp;
            The diagram below shows the structure of the project.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="image" style="width: 100%">
            <img style="width: 100%" src="images/afreecatv_glance_aws_diagram.png">
            <div ng-show="lang_menu.lang == 'korean'">
              프로젝트 구조 다이어그램
            </div>
            <div ng-show="lang_menu.lang == 'english'">
              Project structure diagram
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="header_3" ng-show="lang_menu.lang == 'korean'">
            람다를 이용한 파이썬 코드 실행
          </div>
          <div class="header_3" ng-show="lang_menu.lang == 'english'">
            Running Python code with Lambda
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            람다를 이용하여 아프리카티비의 핫이슈 동영상의 댓글을 수집하는 파이썬 코드를 실행하거나 자연 언어 처리를 하는 파이썬 코드를 실행합니다.&nbsp;
            작업이 항상 진행되지 않고 주기적이기 때문에 람다를 사용하면 컴퓨팅 파워를 많이 아낄 수 있다고 생각해서 람다를 선택했습니다.&nbsp;
            처리된 작업은 플라스크 API 게이트웨이를 통해 몽고디비에 기록됩니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            Use Lambda to run Python code that collects comments from the hot issue videos on AfricaTV, or Python code that does NLP.&nbsp;
            I chose Lambda because I thought that using Lambda would save a lot of computing power because the work is not always going on and it is periodic.&nbsp;
            The processed work is recorded in MongoDB via the Flask API gateway.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="header_3" ng-show="lang_menu.lang == 'korean'">
            플라스크를 통한 핫 키워드 서브
          </div>
          <div class="header_3" ng-show="lang_menu.lang == 'english'">
            Hot keyword serves through Flask
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            이제부터 이슈 키워드와 트렌드 키워드를 합쳐 핫 키워드라고 부르겠습니다.&nbsp;
            람다에 의해서 형성된 핫 키워드는 플라스크 프레임워크를 통해서 유저에게 전달됩니다.&nbsp;
            단순히 디비에서 읽어와 보여주는 역할만 하기 때문에 장고보다는 플라스크가 적절하다고 생각했습니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            From now on, I will combine issue keywords and trend keywords together and call them hot keywords.&nbsp;
            Hot keywords formed by Lambda are passed to the user through the Flask framework.&nbsp;
            I thought that the Flask was better than Django because it only plays the role of reading and showing in the database.
          </div>
        </div>
      </div>
    </div>
    <div class="column_12" ng-show="location == 2">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            댓글 수집
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            Collecting comments
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            제가 아프리카티비 사원이 아니기 때문에 모든 채팅과 댓글을 대상으로 할 수 없습니다.&nbsp;
            따라서 이 프로젝트에서는 아프리카티비 홈페이지 메인에 있는 핫이슈 동영상의 댓글만을 대상으로 합니다.&nbsp;
            다음은 핫이슈 동영상의 댓글을 수집하는 과정입니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            I can not target all chats and comments because I am not an AfricanTV employee.&nbsp;
            Therefore, this project is only for the comments of the hot issue videos on the AfricaTV main page.&nbsp;
            Here is the process of collecting comments on the hot issue videos.
          </div>
        </div>
      </div>
      <div class="row" style="height: 80px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" style="text-align: center;" ng-show="lang_menu.lang == 'korean'">
            핫이슈 동영상 리스트를 가져옵니다<br>
            <i class="fa fa-arrow-down"></i><br>
            한 동영상의 댓글들을 가져오고 해쉬 다이제스트를 이용하여 이미 저장된 댓글인지 확인합니다<br>
            <i class="fa fa-arrow-down"></i><br>
            이미 저장된 댓글이 아니면 몽고디비에 저장합니다<br>
            <i class="fa fa-arrow-down"></i><br>
            댓글이 더 있다면 더 가져와서 저장합니다<br>
            <i class="fa fa-arrow-down"></i><br>
            댓글이 더 이상 없다면 다음 동영상에 대한 작업을 계속 합니다<br>
            <i class="fa fa-arrow-down"></i><br>
            더 이상 동영상이 없다면 작업을 종료합니다
          </div>
          <div class="paragraph" style="text-align: center;" ng-show="lang_menu.lang == 'english'">
            Get a list of hot issue videos<br>
            <i class="fa fa-arrow-down"></i><br>
            Get comments on a video and use a hash digest to see if it is already saved<br>
            <i class="fa fa-arrow-down"></i><br>
            If not already saved, save it to MongoDB<br>
            <i class="fa fa-arrow-down"></i><br>
            If it has more comments, bring more and save<br>
            <i class="fa fa-arrow-down"></i><br>
            If there are no more comments, continue working on the next video<br>
            <i class="fa fa-arrow-down"></i><br>
            If there are no more videos, end the job
          </div>
        </div>
      </div>
      <div class="row" style="height: 80px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="header_3" ng-show="lang_menu.lang == 'korean'">
            핫이슈 동영상 리스트 가져오기
          </div>
          <div class="header_3" ng-show="lang_menu.lang == 'english'">
            Getting a list of hot issue videos
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            핫이슈 동영상 리스트는 다음과 같은 코드로 가져옵니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            The list of hot issue videos is imported with the following code.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="code">
            <div>
              Python
            </div>
            <div>
              <pre>
request = urllib.request.Request('http://live.afreecatv.com:8057/api/get_broadlist_main_info.php')
html = urllib.request.urlopen(request).read()
html = html.decode()

html = re.sub('\\\\/', '/', html)

match = re.search('"HOTISSUE_VOD_DATA":(\[.*\],"STAFF_PICKS_RESULT")', html)
title_numbers = re.findall('"title_no":"(.*?)"', match.group(1))
user_ids = re.findall('"user_id":"(.*?)"', match.group(1))
              </pre>
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            위의 URL로 요청을 하면 JSON 형식으로 데이터를 받을 수 있습니다.&nbsp;
            JSON 형식은 파이썬의 리스트, 딕셔너리와 어느정도 호환되지만 유저 아이디에 '[', ']' 문자가 들어갈 수 있어서 파싱에 문제가 생깁니다.&nbsp;
            따라서 정규표현식을 이용하여 데이터를 추출했습니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            It can receive data in JSON format by requesting the above URL.&nbsp;
            The JSON format is somewhat compatible with Python's lists and dictionaries, but the user id can contain '[', ']' characters, which causes parsing problems.&nbsp;
            So I extracted the data using regular expressions.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="header_3" ng-show="lang_menu.lang == 'korean'">
            댓글 가져오기
          </div>
          <div class="header_3" ng-show="lang_menu.lang == 'english'">
            Getting comments
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            위에서 핫이슈 동영상 정보에는 title_number와 user_id가 있습니다.&nbsp;
            이 두 정보는 동영상을 유일하게 구분하는 값들이고 이 정보들로 댓글을 얻어올 수 있습니다.&nbsp;
            다음은 댓글을 얻어오는 코드입니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            In the above hot issue video information, it can find title_number and user_id.&nbsp;
            These two pieces of information are the values ​​that distinguish the video and can get comments with this information.&nbsp;
            Here's the code to get comments.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="code">
            <div>
              Python
            </div>
            <div>
              <pre>
<span style="color: #7B52AB;">for</span> (title_number, user_id) <span style="color: #7B52AB;">in</span> [(title_numbers[i], user_ids[i]) for i in range(0, len(title_numbers))]:
    last_number = '0'

    <span style="color: #7B52AB;">while</span> 1:
        request = urllib.request.Request('http://stbbs.afreecatv.com/api/bbs_memo_action.php?nTitleNo=' + title_number + '&bj_id=' + user_id + '&nPageNo=1&szAction=get&nVod=1&nLastNo=' + last_number)
        data = urllib.request.urlopen(request).read()
        data = data.decode('unicode_escape')

        data = re.sub('\n', ' ', data)
        data = re.sub('<br.*?>', ' ', data)
        data = re.sub('<img.*?>', '', data)

        match = re.search('"list_data":(\[.+\])},"TOTAL_CNT"', data)

        <span style="color: #7B52AB;">if</span> match <span style="color: #7B52AB;">is</span> None:
            <span style="color: #7B52AB;">break</span>

        comment_numbers = re.findall('"p_comment_no":"(.*?)"', match.group(1))
        user_ids_2 = re.findall('"user_id":"(.*?)"', match.group(1))
        comments = re.findall('"comment":"(.*?)"', match.group(1))
        registration_dates = re.findall('"reg_date":"(.*?)"', match.group(1))

        last_number = comment_numbers[-1]
              </pre>
            </div>
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            위의 코드가 실행되면 최대 21개의 댓글을 얻어옵니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            The above code gets up to 21 comments.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="header_3" ng-show="lang_menu.lang == 'korean'">
            댓글 저장하기
          </div>
          <div class="header_3" ng-show="lang_menu.lang == 'english'">
            Saving comments
          </div>
        </div>
      </div>
      <div class="row" style="height: 10px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="paragraph" ng-show="lang_menu.lang == 'korean'">
            다음 코드는 댓글에 대해서 해쉬 다이제스트를 생성하고 이미 저장된 댓글인지를 확인하고 저장하는 코드입니다.
          </div>
          <div class="paragraph" ng-show="lang_menu.lang == 'english'">
            The following code snippet shows how to create a hash digest for a comment, and to check whether the comment is already saved and to save it.
          </div>
        </div>
      </div>
      <div class="row" style="height: 30px;"></div>
      <div class="row">
        <div class="column_12">
          <div class="code">
            <div>
              Python
            </div>
            <div>
              <pre>
<span style="color: #7B52AB;">for</span> (user_id_2, comment, registration_date) <span style="color: #7B52AB;">in</span> [(user_ids_2[i], comments[i], registration_dates[i]) for i in range(0, len(user_ids_2))]:
    registration_date = datetime(int(registration_date[0:4]), int(registration_date[5:7]), int(registration_date[8:10]), int(registration_date[11:13]), int(registration_date[14:16]))

    sha256 = hashlib.sha256()
    sha256.update(bytes(title_number + ';' + user_id_2 + ';' + comment + ';' + str(registration_date), 'utf-8'))
    hash_digest = sha256.hexdigest()

    doc = collection.find_one({ 'hash_digest': hash_digest })

    <span style="color: #7B52AB;">if</span> doc <span style="color: #7B52AB;">is not</span> None:
        <span style="color: #7B52AB;">continue</span>

    collection.insert_one({
        'title_number': title_number,
        'user_id': user_id_2,
        'comment': comment,
        'registration_date': registration_date,
        'hash_digest': hash_digest,
        'date': datetime.utcnow()
    })
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
    <div class="column_12" ng-show="location == 3">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            자연 언어 처리
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            NLP
          </div>
        </div>
      </div>
    </div>
    <div class="column_12" ng-show="location == 4">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            보완점
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            Improvements
          </div>
        </div>
      </div>
    </div>
    <div class="column_12" ng-show="location == 5">
      <div class="row">
        <div class="column_12">
          <div class="header_2" ng-show="lang_menu.lang == 'korean'">
            트러블 이슈
          </div>
          <div class="header_2" ng-show="lang_menu.lang == 'english'">
            Trouble issues
          </div>
        </div>
      </div>
    </div>
  </div>
  <div class="row" style="height: 200px;"></div>
</div>
